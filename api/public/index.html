<!DOCTYPE html>

<head>

</head>

<body>

  <h3>Ripple Data Test</h3>

  <h4>offersExercised</h4>
      <form name="offersExercisedData">
        Base Currency:
        <input type="text" name="baseCurrency" value="USD">Base Currency Issuer:
        <input type="text" name="baseCurrencyIssuer" value="Bitstamp">

        <br>
        Trade Currency:
        <input type="text" name="tradeCurrency" value="XRP">
        Trade Currency Issuer:
        <input type="text" name="tradeCurrencyIssuer">

        <br>
        Start Time:
        <input type="text" name="startTime" size="50" value="">

        <br>
        End Time:
        <input type="text" name="endTime" size="50" value="">
        
        <br>
        Time Interval:
        <select name="timeIncrement">
          <option value="all" selected>All</option>
          <option value="year">Year</option>
          <option value="month">Month</option>
          <option value="day">Day</option>
          <option value="hour">Hour</option>
          <option value="minute">Minute</option>
          <option value="second">Second</option>
          <option value="none">Don't Group</option>
        </select>
        <!-- Result Format:
        <input type="radio" name="csv" value="true" checked> CSV
        <input type="radio" name="csv" value="false"> JSON
 -->
        <br>
        <button id="submit">Submit</button>
      </form>

      <h4>Results:</h4>
      <table id="results">
      </table>

      <script type="text/javascript" src="./jquery.js"></script>
      <script type="text/javascript">

      var now = new Date();
      $('[name=startTime]').attr('value', now.toString());
      $('[name=endTime]').attr('value', (new Date(now.valueOf() - 2592000000)).toString());

      $('#submit').click(function(e) {
        e.preventDefault();

        $('#results').html('');

        var formData = {};
        $.each($('[name="offersExercisedData"]').serializeArray(), function(index, val) {
          formData[val.name] = val.value;
        });

        formData.base = { currency: formData.baseCurrency };
        if (formData.baseCurrencyIssuer 
          && formData.baseCurrencyIssuer !== '') {
          formData.base.issuer = formData.baseCurrencyIssuer;
        }
        delete formData.baseCurrency;
        delete formData.baseCurrencyIssuer;

        formData.trade = { currency: formData.tradeCurrency };
        if (formData.tradeCurrencyIssuer 
          && formData.tradeCurrencyIssuer !== '') {
          formData.trade.issuer = formData.tradeCurrencyIssuer;
        }
        delete formData.tradeCurrency;
        delete formData.tradeCurrencyIssuer;

        // TODO change this back to being an option
        formData.csv = 'true';

        $.post('/api/offersExercised/', formData, function(res) {

          $('#results').html('');

          if (formData.csv === 'true') {

            var rows = res.split('\n');
            rows.forEach(function(row){
              $('#results').append('<tr><td>' + row.split(',').join('</td><td>') + '</td><tr>');
            });

          } else {

            $('#results').append(res);

          }
          
        });
      });
      </script>

</body>

</html>